# 小説執筆エンジン - コンセプトドキュメント

## プロジェクト概要

### ビジョン
人間の創造的な記憶と発想のプロセスを模倣し、作家の創作活動を支援する小説執筆エンジンを開発する。「うっすらと覚えておく」という人間的な記憶のメカニズムをAIで再現し、予期せぬ創発を生み出すシステム。

### 核となる課題

- 現状のLLMは、コンテキストに入れた内容に強くバイアスがかかり、人間的な創発が機能しない
- 大量のアイデアや取材資料から、関連性がありながらも直接的でない要素を引き出す仕組みが必要
- 作家の創造的なプロセスを妨げない、自然な支援システムの実現

## システムアーキテクチャ

### 技術スタック

- **フロントエンド/バックエンド**: TypeScript（統一言語）
- **デスクトップアプリ**: Electron
- **データベース**: DuckDB WASM
- **日本語処理**: TinySegmenter
- **ベクトル検索**: Vectra/Voy（TypeScriptネイティブ）
- **全文検索**: DuckDB FTS + 日本語トークナイザー

## コア機能

### 1. マルチエージェントシステム

```
編集長（ユーザー）
    ↓
副編集長AI（分析・問題提起）
    ↓
作家AI ←→ 編集AI（議論・創作）
    ↓
ツッコミAI（校閲・検証）
```

### 2. 記憶と創発のメカニズム

- **階層的な情報の抽象化**: 原資料→キーワード→概念→テーマ
- **確率的な情報アクセス**: 時間減衰、関連性、セレンディピティを組み合わせた想起
- **連想ネットワーク**: アイデア間の予期しない繋がりを発見・生成

### 3. ファクトトラッキングシステム

- キャラクター設定、時系列、場所、世界観ルールの自動抽出と管理
- リアルタイムでの整合性チェック（内部整合性、現実整合性、ジャンル整合性）
- 伏線管理と未回収チェック

## 主要機能詳細

### プロット作成フロー

1. 作家AIと編集AIが初期プロットを議論
2. 副編集長AIが構造分析・市場性分析・実現可能性を評価
3. ユーザー（編集長）が最終的な執筆判断

### アイデア管理システム

- **なんでもボックス**: 分類不要で雑多なアイデアを投入
- **アイデアの熟成度**: 時間経過による「深み」の追加
- **化学反応ジェネレーター**: 異なるアイデアの自動組み合わせ
- **アイデアガチャ**: 文脈に応じた適切なランダム性でアイデアを引き出す

### 特徴的な機能

- **ツッコミ専門AI**: 論理的矛盾、ご都合主義、キャラクターブレを検出
- **読者シミュレーション**: 多様な読者層の反応を予測
- **作家の気分システム**: AIの「気分」による文体や発想の変化
- **パラレルワールド執筆**: 同じプロットから複数の展開を同時生成

## 技術実装詳細

### 検索システム

```typescript
// ハイブリッド検索の実装
- 日本語全文検索（DuckDB FTS + TinySegmenter）
- ベクトル類似検索（意味的な関連性）
- メタデータフィルタリング（時期、気分、タグ）
- Reranking（創作フェーズに応じた重み付け）
```

### データモデル

#### アイデア
```typescript
{
  id: number,
  content: string,
  content_tokenized: string,  // 分かち書き済み
  embeddings: number[],       // ベクトル表現
  metadata: {
    mood: string,
    tags: string[],
    created_at: Date,
    access_count: number,
    connections: number[]     // 他のアイデアとの関連
  }
}
```

#### キャラクター設定
```typescript
{
  id: number,
  name: string,
  attributes: JSON,
  first_mentioned: string,
  timeline: Event[]
}
```

### パフォーマンス最適化

- カテゴリ別インデックス分割
- LRUキャッシュによるメモリ管理
- Web Workerでの重い処理の分離
- バッチ処理とトランザクション管理

## 開発優先順位

### Phase 1: 基盤構築
- Electron + TypeScript環境構築
- DuckDB WASM + 日本語全文検索実装
- 基本的なアイデア管理機能

### Phase 2: AI機能実装
- 作家AI・編集AIの基本的な対話システム
- ツッコミAIによる整合性チェック
- ファクトトラッキングシステム

### Phase 3: 高度な機能
- ベクトル検索との統合（ハイブリッド検索）
- 「うっすらとした記憶」メカニズムの実装
- 化学反応ジェネレーターなどの創発的機能

### Phase 4: UI/UX改善
- 編集会議の可視化
- リアルタイムプレビュー
- 直感的な操作インターフェース

## 期待される効果

- 設定の矛盾や伏線の未回収を防ぐ
- 予期せぬアイデアの組み合わせによる創発
- プロの編集プロセスを体験しながらの執筆
- 長編作品でも一貫性を保った創作が可能

## 技術的な課題と対策

- **大規模データでのパフォーマンス**: インデックス分割とキャッシュで対応
- **日本語処理の精度**: TinySegmenterと適切な前処理で対応
- **リアルタイム性**: Web WorkerとDuckDBの高速性を活用