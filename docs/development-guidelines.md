# NovelDrive 開発方針

## 開発理念

### 1. 創造性ファースト
- 技術的完璧さよりも創造的な体験を優先
- 「うまくいかない」ことも創作のヒントになる設計
- バグすらもセレンディピティとして活用する柔軟性

### 2. ローカルファースト
- すべてのデータはユーザーのマシンに保存
- インターネット接続は AI API 呼び出し時のみ必要
- プライバシーとオフライン作業を最優先

### 3. 日本語ファースト
- UI、エラーメッセージ、ドキュメントはすべて日本語優先
- 日本語処理の精度を英語処理より重視
- 縦書き、ルビなど日本語特有の表現に完全対応

## 技術選定の方針

### TypeScript 統一の理由
- フロントエンド/バックエンドの知識共有
- 型安全性による大規模開発の保守性
- Electron との親和性

### DuckDB 選定の理由
- WASM によるブラウザ内実行
- SQL による柔軟なクエリ
- 高速な全文検索とベクトル演算

### ベクトル検索ライブラリの選定
- TypeScript ネイティブ実装を優先（Vectra/Voy）
- 外部サービス依存を避ける
- セレンディピティ検索のカスタマイズ性

## 開発フェーズ

### Phase 0: プロトタイプ（現在）
**目標**: コンセプトの実証と基本機能の動作確認

**優先実装**:
1. Electron + TypeScript の基本セットアップ
2. DuckDB WASM の組み込みと日本語全文検索
3. なんでもボックスの最小実装（テキスト入力のみ）
4. 簡易的なノードビューア

**非実装**:
- AI 機能（モック対応）
- 複雑な UI（最小限の画面のみ）

### Phase 1: 基盤構築
**目標**: 第1層（知識管理システム）の実装

**実装内容**:
- なんでもボックスの完全実装
- ノードの自動生成と保存
- 基本的な検索機能（通常検索のみ）
- シンプルなグラフビュー

**技術課題**:
- 日本語トークナイザーの精度調整
- グラフ描画のパフォーマンス

### Phase 2: AI 統合
**目標**: 第2層（創作エンジン）の基本実装

**実装内容**:
- OpenAI API の統合
- 基本的なマルチエージェントシステム
- プロット生成と管理
- 簡易的な執筆支援

**設計ポイント**:
- API 呼び出しの最適化（コスト管理）
- エージェントの性格付けとプロンプト設計

### Phase 3: セレンディピティ実装
**目標**: 創発的な機能の実装

**実装内容**:
- セレンディピティ検索アルゴリズム
- アイデアガチャ機能
- 24時間稼働モード
- 時間経過による情報の熟成

**技術的挑戦**:
- 高次元ベクトル空間での効率的な検索
- バックグラウンド処理の最適化

### Phase 4: UI/UX 洗練
**目標**: 使いやすく美しいインターフェース

**実装内容**:
- 全画面の実装と洗練
- アニメーションと視覚効果
- ショートカットキーの完全対応
- パフォーマンス最適化

## コーディング規約

### ディレクトリ構造
```
src/
├── main/           # Electron メインプロセス
├── renderer/       # レンダラープロセス
│   ├── components/ # React コンポーネント
│   ├── hooks/      # カスタムフック
│   ├── stores/     # 状態管理
│   └── utils/      # ユーティリティ
├── shared/         # 共有コード
│   ├── types/      # TypeScript 型定義
│   └── constants/  # 定数
└── database/       # データベース関連
    ├── schemas/    # スキーマ定義
    └── queries/    # クエリ関数
```

### 命名規則
- **ファイル名**: kebab-case（例: `anything-box.tsx`）
- **コンポーネント**: PascalCase（例: `AnythingBox`）
- **関数**: camelCase（例: `extractInspiration`）
- **定数**: UPPER_SNAKE_CASE（例: `MAX_NODE_COUNT`）

### 型定義
```typescript
// すべての型は明示的に定義
interface Node {
  id: string;
  content: string;
  type: NodeType;
  createdAt: Date;
  embeddings?: number[];
}

// Union 型で網羅性を保証
type NodeType = 'text' | 'image' | 'character' | 'plot';
```

### エラーハンドリング
```typescript
// Result 型で成功/失敗を表現
type Result<T, E = Error> = 
  | { success: true; data: T }
  | { success: false; error: E };

// 例外は境界で捕捉
try {
  const result = await searchNodes(query);
  return { success: true, data: result };
} catch (error) {
  logger.error('検索エラー', error);
  return { success: false, error };
}
```

## テスト方針

### 単体テスト
- ビジネスロジックは 100% カバレッジ目標
- UI コンポーネントはスナップショットテスト
- データベースクエリはモックで対応

### 統合テスト
- 主要なユーザーフローをカバー
- AI API はモックサーバーで代替
- パフォーマンステストを含む

### E2E テスト
- クリティカルパスのみ実装
- Playwright を使用
- CI での自動実行

## パフォーマンス目標

### 応答性
- なんでもボックスへの入力: 即座に反応（< 50ms）
- ノード検索: 1秒以内に結果表示
- AI 応答: ストリーミングで逐次表示

### メモリ使用量
- 基本動作: 500MB 以下
- 大規模プロジェクト（10万ノード）: 2GB 以下
- メモリリークの定期的な監視

### 起動時間
- コールドスタート: 3秒以内
- ホットリロード: 500ms 以内

## セキュリティ方針

### データ保護
- すべてのデータはローカル保存
- API キーは暗号化して保存
- 自動バックアップ機能

### API 通信
- HTTPS 必須
- API キーはメインプロセスでのみ保持
- レート制限の実装

## リリース方針

### バージョニング
- セマンティックバージョニング準拠
- メジャー: 破壊的変更
- マイナー: 機能追加
- パッチ: バグ修正

### リリースサイクル
- 2週間スプリント
- 月1回のマイナーリリース
- 緊急修正は随時

### 配布方法
- GitHub Releases での配布
- 自動アップデート機能
- Windows/Mac/Linux 対応

## コミュニティ方針

### オープンソース
- MIT ライセンス
- コントリビューション歓迎
- 日本語でのイシュー対応

### フィードバック
- Discord サーバーでの交流
- 定期的なユーザーインタビュー
- フィードバックの可視化

## 開発ツール

### 必須ツール
- Node.js 18+
- pnpm（パッケージマネージャー）
- VS Code（推奨エディタ）

### 推奨拡張機能
- ESLint
- Prettier
- Japanese Language Pack
- Thunder Client（API テスト）

### 開発環境セットアップ
```bash
# リポジトリのクローン
git clone https://github.com/tokoroten/NovelDrive.git
cd NovelDrive

# 依存関係のインストール
pnpm install

# 開発サーバーの起動
pnpm dev

# ビルド
pnpm build
```

## トラブルシューティング

### よくある問題
1. **DuckDB が動かない**: WASM の CORS 設定を確認
2. **日本語が文字化けする**: UTF-8 エンコーディングを確認
3. **メモリ不足**: ノード数の制限を調整

### デバッグ方法
- Electron DevTools の活用
- ログレベルの調整
- パフォーマンスプロファイリング

## 今後の展望

### 中期目標（6ヶ月）
- 基本機能の安定化
- ユーザーコミュニティの形成
- プラグインシステムの設計

### 長期ビジョン（1年以上）
- モバイル版の開発
- クラウド同期オプション
- 他言語への展開
- AI モデルのファインチューニング