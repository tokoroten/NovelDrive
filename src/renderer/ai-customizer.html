<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'">
    <title>AI特性カスタマイザー - NovelDrive</title>
    <link rel="stylesheet" href="./styles/common.css">
    <link rel="stylesheet" href="./styles/ai-customizer.css">
</head>
<body>
    <div class="app-container">
        <!-- サイドバー -->
        <nav class="sidebar">
            <div class="app-title">
                <h1>NovelDrive</h1>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="./writing-editor.html" data-page="writing-editor">
                        <span class="icon">✍️</span>
                        <span>執筆エディタに戻る</span>
                    </a>
                </li>
                <li class="nav-item active">
                    <a href="./ai-customizer.html" data-page="ai-customizer">
                        <span class="icon">🎭</span>
                        <span>AI特性カスタマイザー</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./settings.html" data-page="settings">
                        <span class="icon">⚙️</span>
                        <span>設定</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- メインコンテンツ -->
        <main class="main-content">
            <header class="page-header">
                <div>
                    <h2>AI特性カスタマイザー</h2>
                    <p class="page-description">AIライターの人格とスタイルを自由に調整</p>
                </div>
                <div class="header-actions">
                    <button class="secondary-btn" onclick="resetToDefaults()">
                        <span class="icon">↺</span>
                        デフォルトに戻す
                    </button>
                    <button class="primary-btn" onclick="saveCustomization()">
                        <span class="icon">💾</span>
                        保存
                    </button>
                </div>
            </header>

            <!-- AI選択 -->
            <div class="ai-selector">
                <h3>編集するAIを選択</h3>
                <div class="ai-cards">
                    <div class="ai-card active" data-agent="writer_sharp">
                        <div class="ai-avatar">⚡</div>
                        <div class="ai-info">
                            <h4>シャープライター</h4>
                            <p>キレキレの文体を得意とする</p>
                        </div>
                    </div>
                    <div class="ai-card" data-agent="writer_emotional">
                        <div class="ai-avatar">💖</div>
                        <div class="ai-info">
                            <h4>エモーショナルライター</h4>
                            <p>感情豊かな表現を得意とする</p>
                        </div>
                    </div>
                    <div class="ai-card" data-agent="writer_descriptive">
                        <div class="ai-avatar">🎨</div>
                        <div class="ai-info">
                            <h4>描写マスター</h4>
                            <p>美しい描写を得意とする</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- カスタマイズエリア -->
            <div class="customization-area">
                <div class="canvas-container">
                    <!-- 左パネル: パーソナリティ設定 -->
                    <div class="personality-panel">
                        <h3>🧠 パーソナリティ設定</h3>
                        
                        <div class="personality-section">
                            <h4>基本情報</h4>
                            <div class="form-group">
                                <label for="ai-name">AI名前</label>
                                <input type="text" id="ai-name" placeholder="例: マイカスタムライター">
                            </div>
                            <div class="form-group">
                                <label for="ai-description">説明</label>
                                <textarea id="ai-description" rows="2" placeholder="このAIの特徴を簡潔に..."></textarea>
                            </div>
                        </div>

                        <div class="personality-section">
                            <h4>文体特性</h4>
                            <div class="trait-sliders">
                                <div class="trait-slider">
                                    <label>創造性</label>
                                    <input type="range" id="creativity" min="0" max="100" value="70">
                                    <span class="slider-value">70%</span>
                                </div>
                                <div class="trait-slider">
                                    <label>感情表現</label>
                                    <input type="range" id="emotion" min="0" max="100" value="60">
                                    <span class="slider-value">60%</span>
                                </div>
                                <div class="trait-slider">
                                    <label>描写の詳細さ</label>
                                    <input type="range" id="detail" min="0" max="100" value="50">
                                    <span class="slider-value">50%</span>
                                </div>
                                <div class="trait-slider">
                                    <label>文章の簡潔さ</label>
                                    <input type="range" id="conciseness" min="0" max="100" value="80">
                                    <span class="slider-value">80%</span>
                                </div>
                                <div class="trait-slider">
                                    <label>対話の自然さ</label>
                                    <input type="range" id="dialogue" min="0" max="100" value="70">
                                    <span class="slider-value">70%</span>
                                </div>
                                <div class="trait-slider">
                                    <label>アクションの躍動感</label>
                                    <input type="range" id="action" min="0" max="100" value="60">
                                    <span class="slider-value">60%</span>
                                </div>
                            </div>
                        </div>

                        <div class="personality-section">
                            <h4>スタイル設定</h4>
                            <div class="style-options">
                                <div class="style-group">
                                    <label>文体の雰囲気</label>
                                    <select id="tone">
                                        <option value="sharp">鋭い・シャープ</option>
                                        <option value="warm">温かい・親しみやすい</option>
                                        <option value="cool">クール・冷静</option>
                                        <option value="dramatic">ドラマチック</option>
                                        <option value="poetic">詩的・美しい</option>
                                        <option value="realistic">リアル・現実的</option>
                                    </select>
                                </div>
                                <div class="style-group">
                                    <label>文章の長さ</label>
                                    <select id="length-preference">
                                        <option value="short">短い文を好む</option>
                                        <option value="mixed">短文と長文のミックス</option>
                                        <option value="long">長い文を好む</option>
                                    </select>
                                </div>
                                <div class="style-group">
                                    <label>視点</label>
                                    <select id="perspective">
                                        <option value="first">一人称が得意</option>
                                        <option value="third">三人称が得意</option>
                                        <option value="omniscient">神視点が得意</option>
                                        <option value="adaptive">適応的</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 中央パネル: システムプロンプト編集 -->
                    <div class="prompt-panel">
                        <h3>⚙️ システムプロンプト</h3>
                        
                        <div class="prompt-tabs">
                            <button class="prompt-tab active" data-tab="visual">ビジュアル編集</button>
                            <button class="prompt-tab" data-tab="code">コード編集</button>
                        </div>

                        <div class="prompt-content visual-mode">
                            <div class="prompt-builder">
                                <div class="prompt-section" data-section="role">
                                    <h4>🎭 役割設定</h4>
                                    <div class="role-cards">
                                        <div class="role-card active" data-role="novelist">
                                            <span class="role-icon">📚</span>
                                            <span class="role-name">小説家</span>
                                        </div>
                                        <div class="role-card" data-role="screenwriter">
                                            <span class="role-icon">🎬</span>
                                            <span class="role-name">脚本家</span>
                                        </div>
                                        <div class="role-card" data-role="poet">
                                            <span class="role-icon">🌸</span>
                                            <span class="role-name">詩人</span>
                                        </div>
                                        <div class="role-card" data-role="journalist">
                                            <span class="role-icon">📰</span>
                                            <span class="role-name">ジャーナリスト</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="prompt-section" data-section="goals">
                                    <h4>🎯 目標・使命</h4>
                                    <div class="goals-list">
                                        <div class="goal-item">
                                            <input type="checkbox" id="goal-engaging" checked>
                                            <label for="goal-engaging">読者を魅了する文章を書く</label>
                                        </div>
                                        <div class="goal-item">
                                            <input type="checkbox" id="goal-natural" checked>
                                            <label for="goal-natural">AI臭さを完全に排除する</label>
                                        </div>
                                        <div class="goal-item">
                                            <input type="checkbox" id="goal-emotional">
                                            <label for="goal-emotional">感情に深く訴える</label>
                                        </div>
                                        <div class="goal-item">
                                            <input type="checkbox" id="goal-visual">
                                            <label for="goal-visual">映像的な美しさを追求</label>
                                        </div>
                                        <div class="goal-item">
                                            <input type="checkbox" id="goal-innovative">
                                            <label for="goal-innovative">革新的な表現を探求</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="prompt-section" data-section="constraints">
                                    <h4>🚫 制約・禁止事項</h4>
                                    <div class="constraints-list">
                                        <div class="constraint-item">
                                            <input type="checkbox" id="no-ai-like" checked>
                                            <label for="no-ai-like">AIらしい丁寧すぎる表現を避ける</label>
                                        </div>
                                        <div class="constraint-item">
                                            <input type="checkbox" id="no-cliche" checked>
                                            <label for="no-cliche">ありきたりな表現を避ける</label>
                                        </div>
                                        <div class="constraint-item">
                                            <input type="checkbox" id="no-verbose">
                                            <label for="no-verbose">冗長な文章を避ける</label>
                                        </div>
                                        <div class="constraint-item">
                                            <input type="checkbox" id="no-explanation">
                                            <label for="no-explanation">説明的すぎる文章を避ける</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="prompt-content code-mode" style="display: none;">
                            <div class="code-editor">
                                <textarea id="system-prompt" rows="20" placeholder="システムプロンプトを直接編集..."></textarea>
                            </div>
                        </div>

                        <div class="prompt-actions">
                            <button class="secondary-btn" onclick="generateFromVisual()">
                                <span class="icon">🔧</span>
                                ビジュアル設定から生成
                            </button>
                            <button class="secondary-btn" onclick="validatePrompt()">
                                <span class="icon">✓</span>
                                プロンプト検証
                            </button>
                        </div>
                    </div>

                    <!-- 右パネル: テスト・プレビュー -->
                    <div class="test-panel">
                        <h3>🧪 テスト・プレビュー</h3>
                        
                        <div class="test-section">
                            <h4>クイックテスト</h4>
                            <div class="test-input">
                                <textarea id="test-prompt" rows="3" placeholder="テスト用の文章を入力...">主人公は暗い森の中を歩いていた。</textarea>
                                <button class="primary-btn" onclick="testAI()">
                                    <span class="icon">🚀</span>
                                    テスト実行
                                </button>
                            </div>
                            <div class="test-result" id="test-result">
                                <p class="empty-state">テスト結果がここに表示されます</p>
                            </div>
                        </div>

                        <div class="test-section">
                            <h4>生成サンプル</h4>
                            <div class="sample-actions">
                                <button class="action-btn" onclick="generateSample('continue')">続きを書く</button>
                                <button class="action-btn" onclick="generateSample('dialogue')">対話を書く</button>
                                <button class="action-btn" onclick="generateSample('scene')">シーン描写</button>
                            </div>
                            <div class="sample-result" id="sample-result">
                                <p class="empty-state">サンプルがここに表示されます</p>
                            </div>
                        </div>

                        <div class="test-section">
                            <h4>パフォーマンス</h4>
                            <div class="performance-metrics">
                                <div class="metric-item">
                                    <span class="metric-label">創造性スコア</span>
                                    <div class="metric-bar">
                                        <div class="metric-fill" style="width: 0%" id="creativity-score"></div>
                                    </div>
                                    <span class="metric-value">-</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">自然さスコア</span>
                                    <div class="metric-bar">
                                        <div class="metric-fill" style="width: 0%" id="naturalness-score"></div>
                                    </div>
                                    <span class="metric-value">-</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">一貫性スコア</span>
                                    <div class="metric-bar">
                                        <div class="metric-fill" style="width: 0%" id="consistency-score"></div>
                                    </div>
                                    <span class="metric-value">-</span>
                                </div>
                            </div>
                        </div>

                        <div class="test-section">
                            <h4>記憶・履歴</h4>
                            <div class="memory-display" id="memory-display">
                                <p class="empty-state">記憶がまだありません</p>
                            </div>
                            <button class="secondary-btn full-width" onclick="clearMemory()">
                                <span class="icon">🗑️</span>
                                記憶をクリア
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 保存確認モーダル -->
    <div id="save-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>カスタマイズを保存</h3>
                <button class="close-btn" onclick="closeSaveModal()">✕</button>
            </div>
            <div class="modal-body">
                <p>AIの特性カスタマイズを保存しますか？</p>
                <div class="save-options">
                    <label>
                        <input type="checkbox" id="save-as-preset" checked>
                        プリセットとして保存
                    </label>
                    <div class="form-group">
                        <label for="preset-name">プリセット名</label>
                        <input type="text" id="preset-name" placeholder="例: マイカスタムライター">
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="primary-btn" onclick="confirmSave()">保存</button>
                <button class="secondary-btn" onclick="closeSaveModal()">キャンセル</button>
            </div>
        </div>
    </div>

    <script src="./js/mock-api.js"></script>
    <script src="./js/project-selector.js"></script>
    <script src="./js/ai-customizer.js"></script>
</body>
</html>