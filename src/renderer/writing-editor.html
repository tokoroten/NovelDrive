<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'">
    <title>Âü∑Á≠Ü„Ç®„Éá„Ç£„Çø - NovelDrive</title>
    <link rel="stylesheet" href="./styles/common.css">
    <link rel="stylesheet" href="./styles/writing-editor.css">
    <link rel="stylesheet" href="./styles/ai-assistant.css">
    <link rel="stylesheet" href="./styles/ai-assistant-integrated.css">
    <link rel="stylesheet" href="./styles/ai-personality-criteria-link.css">
    <link rel="stylesheet" href="./styles/project-ai-settings.css">
    <link rel="stylesheet" href="./styles/ai-evaluation-panel.css">
    <link rel="stylesheet" href="./styles/writing-editor-fix.css">
</head>
<body>
    <div class="app-container">
        <!-- „Çµ„Ç§„Éâ„Éê„Éº -->
        <nav class="sidebar">
            <div class="app-title">
                <h1>NovelDrive</h1>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="./agent-meeting.html" data-page="agent-meeting">
                        <span class="icon">ü§ù</span>
                        <span>„Ç®„Éº„Ç∏„Çß„É≥„Éà‰ºöË≠∞ÂÆ§</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./projects.html" data-page="projects">
                        <span class="icon">üìÅ</span>
                        <span>„Éó„É≠„Ç∏„Çß„ÇØ„Éà</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./project-workspace.html" data-page="project-workspace">
                        <span class="icon">üíº</span>
                        <span>„ÉØ„Éº„ÇØ„Çπ„Éö„Éº„Çπ</span>
                    </a>
                </li>
                <li class="nav-item active">
                    <a href="./writing-editor.html" data-page="writing-editor">
                        <span class="icon">‚úçÔ∏è</span>
                        <span>Âü∑Á≠Ü„Ç®„Éá„Ç£„Çø</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./anything-box.html" data-page="anything-box">
                        <span class="icon">üì•</span>
                        <span>„Å™„Çì„Åß„ÇÇ„Éú„ÉÉ„ÇØ„Çπ</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./serendipity.html" data-page="serendipity">
                        <span class="icon">‚ú®</span>
                        <span>„Çª„É¨„É≥„Éá„Ç£„Éî„ÉÜ„Ç£</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./knowledge-graph.html" data-page="knowledge-graph">
                        <span class="icon">üï∏Ô∏è</span>
                        <span>„Éä„É¨„ÉÉ„Ç∏„Ç∞„É©„Éï</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./settings.html" data-page="settings">
                        <span class="icon">‚öôÔ∏è</span>
                        <span>Ë®≠ÂÆö</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
        <main class="main-content writing-layout">
            <!-- Â∑¶„Çµ„Ç§„Éâ„Éë„Éç„É´ -->
            <aside class="left-panel">
                <div class="panel-header">
                    <h3>Á´†ÊßãÊàê</h3>
                    <select id="plot-selector" class="plot-selector">
                        <option value="">„Éó„É≠„ÉÉ„Éà„ÇíÈÅ∏Êäû...</option>
                    </select>
                </div>
                
                <div class="chapters-nav">
                    <div id="chapters-list" class="chapters-list">
                        <!-- Á´†„É™„Çπ„Éà„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                        <div class="empty-state">
                            <p>„Éó„É≠„ÉÉ„Éà„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                        </div>
                    </div>
                </div>
                
                <div class="writing-stats">
                    <h4>Âü∑Á≠ÜÁµ±Ë®à</h4>
                    <div class="stat-item">
                        <span class="stat-label">Á∑èÊñáÂ≠óÊï∞</span>
                        <span class="stat-value" id="total-chars">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ÁèæÂú®„ÅÆÁ´†</span>
                        <span class="stat-value" id="current-chapter-chars">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">‰ªäÊó•„ÅÆÂü∑Á≠Ü</span>
                        <span class="stat-value" id="today-chars">0</span>
                    </div>
                </div>
            </aside>

            <!-- „Ç®„Éá„Ç£„Çø„Ç®„É™„Ç¢ -->
            <div class="editor-container">
                <div class="editor-header">
                    <div class="chapter-info">
                        <div class="chapter-navigation">
                            <button id="prev-chapter" class="chapter-nav-btn" title="Ââç„ÅÆÁ´† (Ctrl+Left)" disabled>
                                <span class="icon">‚óÄ</span>
                            </button>
                            <div class="chapter-details">
                                <h2 id="chapter-title">Á´†„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</h2>
                                <div class="chapter-meta">
                                    <span id="chapter-number"></span>
                                    <span id="last-saved">Êú™‰øùÂ≠ò</span>
                                </div>
                            </div>
                            <button id="next-chapter" class="chapter-nav-btn" title="Ê¨°„ÅÆÁ´† (Ctrl+Right)" disabled>
                                <span class="icon">‚ñ∂</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="editor-toolbar">
                        <button id="save-content" class="toolbar-btn" title="‰øùÂ≠ò (Ctrl+S)">
                            <span class="icon">üíæ</span>
                        </button>
                        <button id="undo" class="toolbar-btn" title="ÂÖÉ„Å´Êàª„Åô (Ctrl+Z)">
                            <span class="icon">‚Ü∂</span>
                        </button>
                        <button id="redo" class="toolbar-btn" title="„ÇÑ„ÇäÁõ¥„Åô (Ctrl+Y)">
                            <span class="icon">‚Ü∑</span>
                        </button>
                        <div class="toolbar-separator"></div>
                        <button id="search-btn" class="toolbar-btn" title="Ê§úÁ¥¢ (Ctrl+F)">
                            <span class="icon">üîç</span>
                        </button>
                        <button id="chapter-jump" class="toolbar-btn" title="Á´†ÁßªÂãï (Ctrl+G)">
                            <span class="icon">üìñ</span>
                        </button>
                        <button id="goto-line" class="toolbar-btn" title="Ë°åÁßªÂãï (Ctrl+Shift+G)">
                            <span class="icon">üî¢</span>
                        </button>
                        <div class="toolbar-separator"></div>
                        <button id="version-history" class="toolbar-btn" title="„Éê„Éº„Ç∏„Éß„É≥Â±•Ê≠¥">
                            <span class="icon">üìö</span>
                        </button>
                        <button id="auto-suggest-toggle" class="toolbar-btn active" title="Ëá™ÂãïÊèêÊ°à„ÇíÁÑ°Âäπ„Å´„Åô„Çã">
                            <span class="icon">üß†</span>
                        </button>
                        <div class="toolbar-separator"></div>
                        <button id="toggle-preview" class="toolbar-btn" title="„Éó„É¨„Éì„É•„Éº">
                            <span class="icon">üëÅÔ∏è</span>
                        </button>
                        <button id="toggle-fullscreen" class="toolbar-btn" title="„Éï„É´„Çπ„ÇØ„É™„Éº„É≥">
                            <span class="icon">‚õ∂</span>
                        </button>
                        <div class="toolbar-separator"></div>
                        <button id="ai-evaluate" class="toolbar-btn" title="AIË©ï‰æ°">
                            <span class="icon">üìä</span>
                            Ë©ï‰æ°
                        </button>
                        <button id="link-criteria" class="toolbar-btn" title="Ë©ï‰æ°Âü∫Ê∫ñË®≠ÂÆö">
                            <span class="icon">üîó</span>
                        </button>
                        <button id="project-ai-settings" class="toolbar-btn" title="„Éó„É≠„Ç∏„Çß„ÇØ„ÉàAIË®≠ÂÆö">
                            <span class="icon">‚öôÔ∏è</span>
                        </button>
                    </div>
                </div>
                
                <div class="editor-content">
                    <div id="editor-wrapper" class="editor-wrapper">
                        <textarea 
                            id="editor" 
                            class="editor" 
                            placeholder="„Åì„Åì„Å´Âü∑Á≠Ü„ÇíÂßã„ÇÅ„Å¶„Åè„Å†„Åï„ÅÑ..."
                            spellcheck="false"
                        ></textarea>
                    </div>
                    
                    <div id="preview-wrapper" class="preview-wrapper" style="display: none;">
                        <div id="preview" class="preview"></div>
                    </div>
                </div>
                
                <div class="editor-footer">
                    <div class="cursor-position">
                        <span id="line-number">1</span>:<span id="column-number">1</span>
                    </div>
                    <div class="word-count">
                        <span id="char-count">0</span>ÊñáÂ≠ó | <span id="word-count">0</span>Ë™û
                    </div>
                </div>
            </div>

            <!-- Âè≥„Çµ„Ç§„Éâ„Éë„Éç„É´ -->
            <aside class="right-panel">
                <!-- „Çø„ÉñÂàá„ÇäÊõø„Åà -->
                <div class="panel-tabs">
                    <button class="tab-btn active" data-tab="outline">„Ç¢„Ç¶„Éà„É©„Ç§„É≥</button>
                    <button class="tab-btn" data-tab="knowledge">Áü•Ë≠ò</button>
                    <button class="tab-btn" data-tab="notes">„É°„É¢</button>
                    <button class="tab-btn" data-tab="ai-assistant">AI„Ç¢„Ç∑„Çπ„Çø„É≥„Éà</button>
                </div>
                
                <!-- „Ç¢„Ç¶„Éà„É©„Ç§„É≥„Çø„Éñ -->
                <div id="outline-tab" class="tab-content active">
                    <div class="outline-content">
                        <h4>Á´†„ÅÆÊ¶ÇË¶Å</h4>
                        <div id="chapter-outline" class="chapter-outline">
                            <p class="empty-state">Á´†„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>
                        </div>
                        
                        <h4>„Ç∑„Éº„É≥</h4>
                        <div id="scenes-list" class="scenes-list">
                            <button class="add-scene-btn">+ „Ç∑„Éº„É≥„ÇíËøΩÂä†</button>
                        </div>
                    </div>
                </div>
                
                <!-- Áü•Ë≠ò„Çø„Éñ -->
                <div id="knowledge-tab" class="tab-content">
                    <div class="knowledge-search">
                        <input type="text" id="knowledge-search" placeholder="Áü•Ë≠ò„ÇíÊ§úÁ¥¢...">
                    </div>
                    <div id="knowledge-results" class="knowledge-results">
                        <!-- Ê§úÁ¥¢ÁµêÊûú„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                    </div>
                </div>
                
                <!-- „É°„É¢„Çø„Éñ -->
                <div id="notes-tab" class="tab-content">
                    <div class="notes-content">
                        <textarea 
                            id="chapter-notes" 
                            class="chapter-notes" 
                            placeholder="„Åì„ÅÆÁ´†„Å´Èñ¢„Åô„Çã„É°„É¢„ÇíË®òÂÖ•..."
                        ></textarea>
                    </div>
                </div>
                
                <!-- AI„Ç¢„Ç∑„Çπ„Çø„É≥„Éà„Çø„Éñ -->
                <div id="ai-assistant-tab" class="tab-content">
                    <div class="ai-assistant-content">
                        <!-- AI„Ç¢„Ç∑„Çπ„Çø„É≥„Éà„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Åå„Åì„Åì„Å´ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Åæ„Åô -->
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <!-- AIÊîØÊè¥„É¢„Éº„ÉÄ„É´ -->
    <div id="ai-assist-modal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>AIÂü∑Á≠ÜÊîØÊè¥</h3>
                <button class="close-btn" onclick="closeAIAssistModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="ai-assist-options">
                    <button class="assist-option" data-action="continue">
                        <span class="option-icon">‚û°Ô∏è</span>
                        <span class="option-title">Á∂ö„Åç„ÇíÊõ∏„Åè</span>
                        <span class="option-desc">ÈÅ∏Êäû„Åó„Åü„ÉÜ„Ç≠„Çπ„Éà„ÅÆÁ∂ö„Åç„ÇíAI„ÅåÂü∑Á≠Ü</span>
                    </button>
                    <button class="assist-option" data-action="improve">
                        <span class="option-icon">‚ú®</span>
                        <span class="option-title">ÊñáÁ´†„ÇíÊîπÂñÑ</span>
                        <span class="option-desc">ÈÅ∏ÊäûÈÉ®ÂàÜ„Çí„Çà„ÇäËâØ„ÅÑË°®Áèæ„Å´</span>
                    </button>
                    <button class="assist-option" data-action="expand">
                        <span class="option-icon">üìù</span>
                        <span class="option-title">Ë©≥Á¥∞„ÇíËøΩÂä†</span>
                        <span class="option-desc">ÊèèÂÜô„ÇÑË™¨Êòé„ÇíË±ä„Åã„Å´</span>
                    </button>
                    <button class="assist-option" data-action="dialogue">
                        <span class="option-icon">üí¨</span>
                        <span class="option-title">ÂØæË©±„ÇíÁîüÊàê</span>
                        <span class="option-desc">„Ç≠„É£„É©„ÇØ„Çø„ÉºÈñì„ÅÆ‰ºöË©±„Çí‰ΩúÊàê</span>
                    </button>
                    <button class="assist-option" data-action="scene">
                        <span class="option-icon">üé¨</span>
                        <span class="option-title">„Ç∑„Éº„É≥ÊèèÂÜô</span>
                        <span class="option-desc">ÊÉÖÊôØ„ÇÑÈõ∞Âõ≤Ê∞ó„ÇíË©≥„Åó„ÅèÊèèÂÜô</span>
                    </button>
                    <button class="assist-option" data-action="brainstorm">
                        <span class="option-icon">üí°</span>
                        <span class="option-title">„Ç¢„Ç§„Éá„Ç¢Âá∫„Åó</span>
                        <span class="option-desc">Â±ïÈñã„ÅÆ„Ç¢„Ç§„Éá„Ç¢„ÇíÊèêÊ°à</span>
                    </button>
                </div>
                
                <div class="ai-context">
                    <h4>„Ç≥„É≥„ÉÜ„Ç≠„Çπ„Éà</h4>
                    <div class="context-info">
                        <p>ÈÅ∏Êäû„Åï„Çå„Åü„ÉÜ„Ç≠„Çπ„Éà: <span id="selected-text-preview"></span></p>
                        <p>ÁèæÂú®„ÅÆÁ´†: <span id="context-chapter"></span></p>
                    </div>
                </div>
                
                <div id="ai-result" class="ai-result" style="display: none;">
                    <h4>AIÊèêÊ°à</h4>
                    <div id="ai-suggestion" class="ai-suggestion"></div>
                    <div class="ai-actions">
                        <button class="primary-btn" onclick="acceptAISuggestion()">Êé°Áî®</button>
                        <button class="secondary-btn" onclick="regenerateAI()">ÂÜçÁîüÊàê</button>
                        <button class="secondary-btn" onclick="rejectAISuggestion()">„Ç≠„É£„É≥„Çª„É´</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- „Ç∑„Éº„É≥Á∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
    <div id="scene-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>„Ç∑„Éº„É≥„ÇíËøΩÂä†</h3>
                <button class="close-btn" onclick="closeSceneModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="scene-title">„Ç∑„Éº„É≥„Çø„Ç§„Éà„É´</label>
                    <input type="text" id="scene-title" placeholder="‰æã: ‰∏ª‰∫∫ÂÖ¨„ÅÆÁôªÂ†¥">
                </div>
                <div class="form-group">
                    <label for="scene-location">Â†¥ÊâÄ</label>
                    <input type="text" id="scene-location" placeholder="‰æã: Ë®òÊÜ∂„ÅÆ„Ç¢„Éº„Ç´„Ç§„Éñ">
                </div>
                <div class="form-group">
                    <label for="scene-characters">ÁôªÂ†¥‰∫∫Áâ©</label>
                    <input type="text" id="scene-characters" placeholder="‰æã: „Çµ„É©„ÄÅ„Éû„Éº„Ç´„Çπ">
                </div>
                <div class="form-group">
                    <label for="scene-summary">Ê¶ÇË¶Å</label>
                    <textarea id="scene-summary" rows="3" placeholder="„Åì„ÅÆ„Ç∑„Éº„É≥„ÅßËµ∑„Åì„Çã„Åì„Å®"></textarea>
                </div>
            </div>
            <div class="modal-actions">
                <button class="primary-btn" onclick="saveScene()">‰øùÂ≠ò</button>
                <button class="secondary-btn" onclick="closeSceneModal()">„Ç≠„É£„É≥„Çª„É´</button>
            </div>
        </div>
    </div>

    <!-- Ê§úÁ¥¢„É¢„Éº„ÉÄ„É´ -->
    <div id="search-modal" class="search-modal" style="display: none;">
        <div class="search-modal-content">
            <div class="search-header">
                <div class="search-input-container">
                    <input type="text" id="search-input" class="search-input" placeholder="Ê§úÁ¥¢..." autocomplete="off">
                    <button id="search-prev" class="search-nav-btn" title="Ââç„ÇíÊ§úÁ¥¢ (Shift+Enter)">‚Üë</button>
                    <button id="search-next" class="search-nav-btn" title="Ê¨°„ÇíÊ§úÁ¥¢ (Enter)">‚Üì</button>
                    <button id="search-close" class="search-close-btn" title="Èñâ„Åò„Çã (Esc)">‚úï</button>
                </div>
                <div class="search-options">
                    <label class="search-option">
                        <input type="checkbox" id="case-sensitive">
                        Â§ßÊñáÂ≠óÂ∞èÊñáÂ≠ó„ÇíÂå∫Âà•
                    </label>
                    <label class="search-option">
                        <input type="checkbox" id="whole-word">
                        ÂçòË™ûÂÖ®‰Ωì
                    </label>
                    <label class="search-option">
                        <input type="checkbox" id="regex-search">
                        Ê≠£Ë¶èË°®Áèæ
                    </label>
                </div>
            </div>
            <div class="search-replace-container" style="display: none;">
                <div class="replace-input-container">
                    <input type="text" id="replace-input" class="replace-input" placeholder="ÁΩÆÊèõ..." autocomplete="off">
                    <button id="replace-current" class="replace-btn">ÁΩÆÊèõ</button>
                    <button id="replace-all" class="replace-btn">„Åô„Åπ„Å¶ÁΩÆÊèõ</button>
                </div>
            </div>
            <div class="search-info">
                <span id="search-count">0‰ª∂„ÅÆÁµêÊûú</span>
                <button id="toggle-replace" class="toggle-replace-btn">ÁΩÆÊèõ</button>
            </div>
        </div>
    </div>

    <!-- Á´†ÁßªÂãï„É¢„Éº„ÉÄ„É´ -->
    <div id="chapter-jump-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Á´†ÁßªÂãï</h3>
                <button class="close-btn" onclick="closeChapterJumpModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="chapter-jump-list" id="chapter-jump-list">
                    <!-- Á´†„É™„Çπ„Éà„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                </div>
            </div>
        </div>
    </div>

    <!-- Ë°åÁßªÂãï„É¢„Éº„ÉÄ„É´ -->
    <div id="goto-line-modal" class="modal" style="display: none;">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>Ë°åÁßªÂãï</h3>
                <button class="close-btn" onclick="closeGotoLineModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="goto-line-input">ÁßªÂãïÂÖà„ÅÆË°åÁï™Âè∑</label>
                    <input type="number" id="goto-line-input" min="1" placeholder="Ë°åÁï™Âè∑„ÇíÂÖ•Âäõ..." autocomplete="off">
                    <small class="help-text">ÁèæÂú®„ÅÆË°å: <span id="current-line-display">1</span> / Á∑èË°åÊï∞: <span id="total-lines-display">1</span></small>
                </div>
            </div>
            <div class="modal-actions">
                <button class="primary-btn" onclick="performGotoLine()">ÁßªÂãï</button>
                <button class="secondary-btn" onclick="closeGotoLineModal()">„Ç≠„É£„É≥„Çª„É´</button>
            </div>
        </div>
    </div>


    <script src="./js/mock-api.js"></script>
    <script src="./js/project-selector.js"></script>
    <script src="./js/keyboard-shortcuts.js"></script>
    <script src="./js/undo-redo-manager.js"></script>
    <script src="./js/version-manager.js"></script>
    <script src="./js/version-compare-ui.js"></script>
    <script src="./js/knowledge-suggest.js"></script>
    <script src="./js/search-manager.js"></script>
    <script src="./js/ai-thread-manager.js"></script>
    <script src="./js/ai-writing-assistant.js"></script>
    <script src="./js/ai-personality-canvas.js"></script>
    <script src="./js/evaluation-criteria-canvas.js"></script>
    <script src="./js/ai-personality-criteria-link.js"></script>
    <script src="./js/project-ai-settings.js"></script>
    <script src="./js/ai-evaluation-panel.js"></script>
    <script src="./js/writing-editor.js"></script>
</body>
</html>