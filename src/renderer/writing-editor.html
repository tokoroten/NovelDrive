<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'">
    <title>Âü∑Á≠Ü„Ç®„Éá„Ç£„Çø - NovelDrive</title>
    <link rel="stylesheet" href="./styles/common.css">
    <link rel="stylesheet" href="./styles/writing-editor.css">
</head>
<body>
    <div class="app-container">
        <!-- „Çµ„Ç§„Éâ„Éê„Éº -->
        <nav class="sidebar">
            <div class="app-title">
                <h1>NovelDrive</h1>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="./projects.html" data-page="projects">
                        <span class="icon">üìÅ</span>
                        <span>„Éó„É≠„Ç∏„Çß„ÇØ„Éà</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./plot-management.html" data-page="plot-management">
                        <span class="icon">üìä</span>
                        <span>„Éó„É≠„ÉÉ„ÉàÁÆ°ÁêÜ</span>
                    </a>
                </li>
                <li class="nav-item active">
                    <a href="#" data-page="writing-editor">
                        <span class="icon">‚úçÔ∏è</span>
                        <span>Âü∑Á≠Ü„Ç®„Éá„Ç£„Çø</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./agent-meeting.html" data-page="agent-meeting">
                        <span class="icon">ü§ù</span>
                        <span>„Ç®„Éº„Ç∏„Çß„É≥„Éà‰ºöË≠∞ÂÆ§</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" data-page="settings">
                        <span class="icon">‚öôÔ∏è</span>
                        <span>Ë®≠ÂÆö</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
        <main class="main-content writing-layout">
            <!-- Â∑¶„Çµ„Ç§„Éâ„Éë„Éç„É´ -->
            <aside class="left-panel">
                <div class="panel-header">
                    <h3>Á´†ÊßãÊàê</h3>
                    <select id="plot-selector" class="plot-selector">
                        <option value="">„Éó„É≠„ÉÉ„Éà„ÇíÈÅ∏Êäû...</option>
                    </select>
                </div>
                
                <div class="chapters-nav">
                    <div id="chapters-list" class="chapters-list">
                        <!-- Á´†„É™„Çπ„Éà„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                        <div class="empty-state">
                            <p>„Éó„É≠„ÉÉ„Éà„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                        </div>
                    </div>
                </div>
                
                <div class="writing-stats">
                    <h4>Âü∑Á≠ÜÁµ±Ë®à</h4>
                    <div class="stat-item">
                        <span class="stat-label">Á∑èÊñáÂ≠óÊï∞</span>
                        <span class="stat-value" id="total-chars">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ÁèæÂú®„ÅÆÁ´†</span>
                        <span class="stat-value" id="current-chapter-chars">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">‰ªäÊó•„ÅÆÂü∑Á≠Ü</span>
                        <span class="stat-value" id="today-chars">0</span>
                    </div>
                </div>
            </aside>

            <!-- „Ç®„Éá„Ç£„Çø„Ç®„É™„Ç¢ -->
            <div class="editor-container">
                <div class="editor-header">
                    <div class="chapter-info">
                        <h2 id="chapter-title">Á´†„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</h2>
                        <div class="chapter-meta">
                            <span id="chapter-number"></span>
                            <span id="last-saved">Êú™‰øùÂ≠ò</span>
                        </div>
                    </div>
                    
                    <div class="editor-toolbar">
                        <button id="save-content" class="toolbar-btn" title="‰øùÂ≠ò (Ctrl+S)">
                            <span class="icon">üíæ</span>
                        </button>
                        <button id="undo" class="toolbar-btn" title="ÂÖÉ„Å´Êàª„Åô (Ctrl+Z)">
                            <span class="icon">‚Ü∂</span>
                        </button>
                        <button id="redo" class="toolbar-btn" title="„ÇÑ„ÇäÁõ¥„Åô (Ctrl+Y)">
                            <span class="icon">‚Ü∑</span>
                        </button>
                        <div class="toolbar-separator"></div>
                        <button id="toggle-preview" class="toolbar-btn" title="„Éó„É¨„Éì„É•„Éº">
                            <span class="icon">üëÅÔ∏è</span>
                        </button>
                        <button id="toggle-fullscreen" class="toolbar-btn" title="„Éï„É´„Çπ„ÇØ„É™„Éº„É≥">
                            <span class="icon">‚õ∂</span>
                        </button>
                        <div class="toolbar-separator"></div>
                        <button id="ai-assist" class="toolbar-btn primary" title="AIÊîØÊè¥">
                            <span class="icon">‚ú®</span>
                            AIÊîØÊè¥
                        </button>
                    </div>
                </div>
                
                <div class="editor-content">
                    <div id="editor-wrapper" class="editor-wrapper">
                        <textarea 
                            id="editor" 
                            class="editor" 
                            placeholder="„Åì„Åì„Å´Âü∑Á≠Ü„ÇíÂßã„ÇÅ„Å¶„Åè„Å†„Åï„ÅÑ..."
                            spellcheck="false"
                        ></textarea>
                    </div>
                    
                    <div id="preview-wrapper" class="preview-wrapper" style="display: none;">
                        <div id="preview" class="preview"></div>
                    </div>
                </div>
                
                <div class="editor-footer">
                    <div class="cursor-position">
                        <span id="line-number">1</span>:<span id="column-number">1</span>
                    </div>
                    <div class="word-count">
                        <span id="char-count">0</span>ÊñáÂ≠ó | <span id="word-count">0</span>Ë™û
                    </div>
                </div>
            </div>

            <!-- Âè≥„Çµ„Ç§„Éâ„Éë„Éç„É´ -->
            <aside class="right-panel">
                <!-- „Çø„ÉñÂàá„ÇäÊõø„Åà -->
                <div class="panel-tabs">
                    <button class="tab-btn active" data-tab="outline">„Ç¢„Ç¶„Éà„É©„Ç§„É≥</button>
                    <button class="tab-btn" data-tab="knowledge">Áü•Ë≠ò</button>
                    <button class="tab-btn" data-tab="notes">„É°„É¢</button>
                </div>
                
                <!-- „Ç¢„Ç¶„Éà„É©„Ç§„É≥„Çø„Éñ -->
                <div id="outline-tab" class="tab-content active">
                    <div class="outline-content">
                        <h4>Á´†„ÅÆÊ¶ÇË¶Å</h4>
                        <div id="chapter-outline" class="chapter-outline">
                            <p class="empty-state">Á´†„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>
                        </div>
                        
                        <h4>„Ç∑„Éº„É≥</h4>
                        <div id="scenes-list" class="scenes-list">
                            <button class="add-scene-btn">+ „Ç∑„Éº„É≥„ÇíËøΩÂä†</button>
                        </div>
                    </div>
                </div>
                
                <!-- Áü•Ë≠ò„Çø„Éñ -->
                <div id="knowledge-tab" class="tab-content">
                    <div class="knowledge-search">
                        <input type="text" id="knowledge-search" placeholder="Áü•Ë≠ò„ÇíÊ§úÁ¥¢...">
                    </div>
                    <div id="knowledge-results" class="knowledge-results">
                        <!-- Ê§úÁ¥¢ÁµêÊûú„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                    </div>
                </div>
                
                <!-- „É°„É¢„Çø„Éñ -->
                <div id="notes-tab" class="tab-content">
                    <div class="notes-content">
                        <textarea 
                            id="chapter-notes" 
                            class="chapter-notes" 
                            placeholder="„Åì„ÅÆÁ´†„Å´Èñ¢„Åô„Çã„É°„É¢„ÇíË®òÂÖ•..."
                        ></textarea>
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <!-- AIÊîØÊè¥„É¢„Éº„ÉÄ„É´ -->
    <div id="ai-assist-modal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>AIÂü∑Á≠ÜÊîØÊè¥</h3>
                <button class="close-btn" onclick="closeAIAssistModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="ai-assist-options">
                    <button class="assist-option" data-action="continue">
                        <span class="option-icon">‚û°Ô∏è</span>
                        <span class="option-title">Á∂ö„Åç„ÇíÊõ∏„Åè</span>
                        <span class="option-desc">ÈÅ∏Êäû„Åó„Åü„ÉÜ„Ç≠„Çπ„Éà„ÅÆÁ∂ö„Åç„ÇíAI„ÅåÂü∑Á≠Ü</span>
                    </button>
                    <button class="assist-option" data-action="improve">
                        <span class="option-icon">‚ú®</span>
                        <span class="option-title">ÊñáÁ´†„ÇíÊîπÂñÑ</span>
                        <span class="option-desc">ÈÅ∏ÊäûÈÉ®ÂàÜ„Çí„Çà„ÇäËâØ„ÅÑË°®Áèæ„Å´</span>
                    </button>
                    <button class="assist-option" data-action="expand">
                        <span class="option-icon">üìù</span>
                        <span class="option-title">Ë©≥Á¥∞„ÇíËøΩÂä†</span>
                        <span class="option-desc">ÊèèÂÜô„ÇÑË™¨Êòé„ÇíË±ä„Åã„Å´</span>
                    </button>
                    <button class="assist-option" data-action="dialogue">
                        <span class="option-icon">üí¨</span>
                        <span class="option-title">ÂØæË©±„ÇíÁîüÊàê</span>
                        <span class="option-desc">„Ç≠„É£„É©„ÇØ„Çø„ÉºÈñì„ÅÆ‰ºöË©±„Çí‰ΩúÊàê</span>
                    </button>
                    <button class="assist-option" data-action="scene">
                        <span class="option-icon">üé¨</span>
                        <span class="option-title">„Ç∑„Éº„É≥ÊèèÂÜô</span>
                        <span class="option-desc">ÊÉÖÊôØ„ÇÑÈõ∞Âõ≤Ê∞ó„ÇíË©≥„Åó„ÅèÊèèÂÜô</span>
                    </button>
                    <button class="assist-option" data-action="brainstorm">
                        <span class="option-icon">üí°</span>
                        <span class="option-title">„Ç¢„Ç§„Éá„Ç¢Âá∫„Åó</span>
                        <span class="option-desc">Â±ïÈñã„ÅÆ„Ç¢„Ç§„Éá„Ç¢„ÇíÊèêÊ°à</span>
                    </button>
                </div>
                
                <div class="ai-context">
                    <h4>„Ç≥„É≥„ÉÜ„Ç≠„Çπ„Éà</h4>
                    <div class="context-info">
                        <p>ÈÅ∏Êäû„Åï„Çå„Åü„ÉÜ„Ç≠„Çπ„Éà: <span id="selected-text-preview"></span></p>
                        <p>ÁèæÂú®„ÅÆÁ´†: <span id="context-chapter"></span></p>
                    </div>
                </div>
                
                <div id="ai-result" class="ai-result" style="display: none;">
                    <h4>AIÊèêÊ°à</h4>
                    <div id="ai-suggestion" class="ai-suggestion"></div>
                    <div class="ai-actions">
                        <button class="primary-btn" onclick="acceptAISuggestion()">Êé°Áî®</button>
                        <button class="secondary-btn" onclick="regenerateAI()">ÂÜçÁîüÊàê</button>
                        <button class="secondary-btn" onclick="rejectAISuggestion()">„Ç≠„É£„É≥„Çª„É´</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- „Ç∑„Éº„É≥Á∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
    <div id="scene-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>„Ç∑„Éº„É≥„ÇíËøΩÂä†</h3>
                <button class="close-btn" onclick="closeSceneModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="scene-title">„Ç∑„Éº„É≥„Çø„Ç§„Éà„É´</label>
                    <input type="text" id="scene-title" placeholder="‰æã: ‰∏ª‰∫∫ÂÖ¨„ÅÆÁôªÂ†¥">
                </div>
                <div class="form-group">
                    <label for="scene-location">Â†¥ÊâÄ</label>
                    <input type="text" id="scene-location" placeholder="‰æã: Ë®òÊÜ∂„ÅÆ„Ç¢„Éº„Ç´„Ç§„Éñ">
                </div>
                <div class="form-group">
                    <label for="scene-characters">ÁôªÂ†¥‰∫∫Áâ©</label>
                    <input type="text" id="scene-characters" placeholder="‰æã: „Çµ„É©„ÄÅ„Éû„Éº„Ç´„Çπ">
                </div>
                <div class="form-group">
                    <label for="scene-summary">Ê¶ÇË¶Å</label>
                    <textarea id="scene-summary" rows="3" placeholder="„Åì„ÅÆ„Ç∑„Éº„É≥„ÅßËµ∑„Åì„Çã„Åì„Å®"></textarea>
                </div>
            </div>
            <div class="modal-actions">
                <button class="primary-btn" onclick="saveScene()">‰øùÂ≠ò</button>
                <button class="secondary-btn" onclick="closeSceneModal()">„Ç≠„É£„É≥„Çª„É´</button>
            </div>
        </div>
    </div>

    <script src="./js/writing-editor.js"></script>
</body>
</html>