<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com; style-src 'self' 'unsafe-inline'">
    <title>NovelDrive</title>
    <link rel="stylesheet" href="./styles/common.css">
    <link rel="stylesheet" href="./styles/projects.css">
    <link rel="stylesheet" href="./styles/agent-meeting.css">
    <link rel="stylesheet" href="./styles/project-workspace.css">
    <link rel="stylesheet" href="./styles/writing-editor.css">
    <link rel="stylesheet" href="./styles/anything-box.css">
    <link rel="stylesheet" href="./styles/serendipity.css">
    <link rel="stylesheet" href="./styles/knowledge-graph.css">
    <link rel="stylesheet" href="./styles/settings.css">
</head>
<body>
    <div id="app"></div>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Zustand -->
    <script>
        // Simple Zustand implementation
        (function() {
            const subscribers = new Set();
            let state = {};
            
            const setState = (partial) => {
                const nextState = typeof partial === 'function' ? partial(state) : partial;
                state = Object.assign({}, state, nextState);
                subscribers.forEach(fn => fn(state));
            };
            
            const subscribe = (listener) => {
                subscribers.add(listener);
                return () => subscribers.delete(listener);
            };
            
            const getState = () => state;
            
            window.zustand = {
                create: (createState) => {
                    const api = { setState, getState, subscribe };
                    state = createState(setState, getState, api);
                    
                    const useStore = (selector = (s) => s) => {
                        const [, forceUpdate] = React.useReducer(x => x + 1, 0);
                        
                        React.useEffect(() => {
                            const listener = () => forceUpdate();
                            const unsubscribe = subscribe(listener);
                            return unsubscribe;
                        }, []);
                        
                        return selector(state);
                    };
                    
                    // Add methods to useStore
                    Object.assign(useStore, api);
                    
                    return useStore;
                }
            };
        })();
    </script>
    
    <!-- Application scripts -->
    <script src="./js/mock-api.js"></script>
    <script src="./js/stores/app-store.js"></script>
    
    <!-- Initialize Zustand store -->
    <script>
        window.useStore = window.zustand.create(window.createAppStore);
    </script>
    
    <!-- Page Components -->
    <script src="./js/pages/projects-page.js"></script>
    <script src="./js/pages/agent-meeting-page.js"></script>
    
    <!-- Placeholder page components -->
    <script>
        // Create placeholder components for other pages
        const { createElement: h } = React;
        
        window.ProjectWorkspacePage = function() {
            const currentProjectId = window.useStore(state => state.currentProjectId);
            
            return h('div', null,
                h('header', { className: 'page-header' },
                    h('h2', null, 'プロジェクトワークスペース'),
                    h('p', { className: 'page-description' }, 'プロジェクトの詳細管理')
                ),
                !currentProjectId ? 
                    h('div', { className: 'empty-state' },
                        h('p', null, 'プロジェクトを選択してください')
                    ) :
                    h('div', null, 'ワークスペースの実装予定')
            );
        };
        
        window.WritingEditorPage = function() {
            return h('div', null,
                h('header', { className: 'page-header' },
                    h('h2', null, '執筆エディタ')
                ),
                h('div', null, '執筆エディタの実装予定')
            );
        };
        
        window.AnythingBoxPage = function() {
            return h('div', null,
                h('header', { className: 'page-header' },
                    h('h2', null, 'なんでもボックス')
                ),
                h('div', null, 'なんでもボックスの実装予定')
            );
        };
        
        window.SerendipityPage = function() {
            return h('div', null,
                h('header', { className: 'page-header' },
                    h('h2', null, 'セレンディピティ検索')
                ),
                h('div', null, 'セレンディピティ検索の実装予定')
            );
        };
        
        window.KnowledgeGraphPage = function() {
            return h('div', null,
                h('header', { className: 'page-header' },
                    h('h2', null, 'ナレッジグラフ')
                ),
                h('div', null, 'ナレッジグラフの実装予定')
            );
        };
        
        window.SettingsPage = function() {
            return h('div', null,
                h('header', { className: 'page-header' },
                    h('h2', null, '設定')
                ),
                h('div', null, '設定の実装予定')
            );
        };
        
        // Page components map
        window.pageComponents = {
            'agent-meeting': window.AgentMeetingPage,
            'projects': window.ProjectsPage,
            'project-workspace': window.ProjectWorkspacePage,
            'writing-editor': window.WritingEditorPage,
            'anything-box': window.AnythingBoxPage,
            'serendipity': window.SerendipityPage,
            'knowledge-graph': window.KnowledgeGraphPage,
            'settings': window.SettingsPage
        };
    </script>
    
    <!-- Main App -->
    <script src="./js/app-main.js"></script>
    
    <!-- Mount App -->
    <script>
        const root = ReactDOM.createRoot(document.getElementById('app'));
        root.render(React.createElement(window.App));
    </script>
</body>
</html>