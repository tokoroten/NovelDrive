<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'">
    <title>プロジェクトワークスペース - NovelDrive</title>
    <link rel="stylesheet" href="./styles/common.css">
    <link rel="stylesheet" href="./styles/project-workspace.css">
</head>
<body>
    <div class="app-container">
        <!-- サイドバー -->
        <nav class="sidebar">
            <div class="app-title">
                <h1>NovelDrive</h1>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="./agent-meeting.html" data-page="agent-meeting">
                        <span class="icon">🤝</span>
                        <span>エージェント会議室</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./projects.html" data-page="projects">
                        <span class="icon">📁</span>
                        <span>プロジェクト</span>
                    </a>
                </li>
                <li class="nav-item active">
                    <a href="#" data-page="project-workspace">
                        <span class="icon">💼</span>
                        <span>ワークスペース</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./writing-editor.html" data-page="writing-editor">
                        <span class="icon">✍️</span>
                        <span>執筆エディタ</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./anything-box.html" data-page="anything-box">
                        <span class="icon">📥</span>
                        <span>なんでもボックス</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./serendipity.html" data-page="serendipity">
                        <span class="icon">✨</span>
                        <span>セレンディピティ</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./knowledge-graph.html" data-page="knowledge-graph">
                        <span class="icon">🕸️</span>
                        <span>ナレッジグラフ</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./settings.html" data-page="settings">
                        <span class="icon">⚙️</span>
                        <span>設定</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- メインコンテンツ -->
        <main class="main-content">
            <header class="page-header">
                <div class="project-header">
                    <div class="project-info">
                        <h2 id="project-name">プロジェクト名</h2>
                        <p class="page-description" id="project-description">プロジェクトの説明</p>
                        <div class="project-meta">
                            <span class="meta-item">
                                <span class="icon">📊</span>
                                <span id="project-progress">0%</span> 完了
                            </span>
                            <span class="meta-item">
                                <span class="icon">📝</span>
                                <span id="project-word-count">0</span> 文字
                            </span>
                            <span class="meta-item">
                                <span class="icon">📚</span>
                                <span id="project-chapter-count">0</span> 章
                            </span>
                        </div>
                    </div>
                    <div class="project-actions">
                        <button class="secondary-btn" onclick="editProjectSettings()">
                            <span class="icon">⚙️</span>
                            プロジェクト設定
                        </button>
                        <button class="primary-btn" onclick="startWriting()">
                            <span class="icon">✍️</span>
                            執筆開始
                        </button>
                    </div>
                </div>
            </header>

            <!-- ワークスペースタブ -->
            <div class="workspace-tabs">
                <button class="workspace-tab active" data-tab="overview">
                    <span class="icon">📊</span>
                    概要
                </button>
                <button class="workspace-tab" data-tab="chapters">
                    <span class="icon">📖</span>
                    章管理
                </button>
                <button class="workspace-tab" data-tab="characters">
                    <span class="icon">👥</span>
                    キャラクター
                </button>
                <button class="workspace-tab" data-tab="knowledge">
                    <span class="icon">📚</span>
                    知識ベース
                </button>
                <button class="workspace-tab" data-tab="timeline">
                    <span class="icon">⏰</span>
                    タイムライン
                </button>
            </div>

            <!-- 概要タブ -->
            <div class="tab-content active" data-tab="overview">
                <div class="overview-grid">
                    <!-- 進捗サマリー -->
                    <div class="summary-card">
                        <h3>進捗サマリー</h3>
                        <div class="progress-stats">
                            <div class="progress-circle" id="overall-progress">
                                <div class="progress-value">0%</div>
                                <div class="progress-label">全体進捗</div>
                            </div>
                            <div class="progress-details">
                                <div class="stat-item">
                                    <span class="stat-label">目標文字数</span>
                                    <span class="stat-value" id="target-words">50,000</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">現在の文字数</span>
                                    <span class="stat-value" id="current-words">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">残り文字数</span>
                                    <span class="stat-value" id="remaining-words">50,000</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">予想完了日</span>
                                    <span class="stat-value" id="estimated-completion">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 最近のアクティビティ -->
                    <div class="activity-card">
                        <h3>最近のアクティビティ</h3>
                        <div class="activity-list" id="recent-activity">
                            <div class="activity-item">
                                <span class="activity-time">2時間前</span>
                                <span class="activity-description">第3章「出会い」を編集</span>
                            </div>
                            <div class="activity-item">
                                <span class="activity-time">昨日</span>
                                <span class="activity-description">キャラクター「エリシア」を追加</span>
                            </div>
                            <div class="activity-item">
                                <span class="activity-time">3日前</span>
                                <span class="activity-description">プロット会議を実行</span>
                            </div>
                        </div>
                    </div>

                    <!-- クイックアクション -->
                    <div class="quick-actions-card">
                        <h3>クイックアクション</h3>
                        <div class="quick-actions-grid">
                            <button class="quick-action" onclick="createNewChapter()">
                                <span class="icon">📄</span>
                                <span>新しい章を作成</span>
                            </button>
                            <button class="quick-action" onclick="openAgentMeeting()">
                                <span class="icon">🤝</span>
                                <span>エージェント会議</span>
                            </button>
                            <button class="quick-action" onclick="addKnowledge()">
                                <span class="icon">💡</span>
                                <span>知識を追加</span>
                            </button>
                            <button class="quick-action" onclick="generateIdeas()">
                                <span class="icon">✨</span>
                                <span>アイデア生成</span>
                            </button>
                        </div>
                    </div>

                    <!-- 統計情報 -->
                    <div class="stats-card">
                        <h3>執筆統計</h3>
                        <div class="stats-grid">
                            <div class="stat-box">
                                <div class="stat-number" id="daily-words">0</div>
                                <div class="stat-label">今日の文字数</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-number" id="weekly-words">0</div>
                                <div class="stat-label">今週の文字数</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-number" id="total-sessions">0</div>
                                <div class="stat-label">執筆セッション</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-number" id="avg-daily">0</div>
                                <div class="stat-label">日平均文字数</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 章管理タブ -->
            <div class="tab-content" data-tab="chapters">
                <div class="chapters-header">
                    <h3>章管理</h3>
                    <button class="primary-btn" onclick="createNewChapter()">
                        <span class="icon">➕</span>
                        新しい章を作成
                    </button>
                </div>
                <div class="chapters-list" id="chapters-list">
                    <!-- 章リストがここに表示される -->
                </div>
            </div>

            <!-- キャラクタータブ -->
            <div class="tab-content" data-tab="characters">
                <div class="characters-header">
                    <h3>キャラクター管理</h3>
                    <button class="primary-btn" onclick="createNewCharacter()">
                        <span class="icon">➕</span>
                        新しいキャラクター
                    </button>
                </div>
                <div class="characters-grid" id="characters-grid">
                    <!-- キャラクターカードがここに表示される -->
                </div>
            </div>

            <!-- 知識ベースタブ -->
            <div class="tab-content" data-tab="knowledge">
                <div class="knowledge-header">
                    <h3>プロジェクト知識ベース</h3>
                    <div class="knowledge-actions">
                        <button class="secondary-btn" onclick="openKnowledgeGraph()">
                            <span class="icon">🕸️</span>
                            ナレッジグラフ
                        </button>
                        <button class="primary-btn" onclick="addKnowledge()">
                            <span class="icon">➕</span>
                            知識を追加
                        </button>
                    </div>
                </div>
                <div class="knowledge-grid" id="knowledge-grid">
                    <!-- 知識カードがここに表示される -->
                </div>
            </div>

            <!-- タイムラインタブ -->
            <div class="tab-content" data-tab="timeline">
                <div class="timeline-header">
                    <h3>プロジェクトタイムライン</h3>
                    <div class="timeline-filters">
                        <button class="filter-btn active" data-filter="all">すべて</button>
                        <button class="filter-btn" data-filter="writing">執筆</button>
                        <button class="filter-btn" data-filter="editing">編集</button>
                        <button class="filter-btn" data-filter="planning">企画</button>
                    </div>
                </div>
                <div class="timeline-container" id="timeline-container">
                    <!-- タイムラインがここに表示される -->
                </div>
            </div>
        </main>
    </div>

    <!-- 新規章作成モーダル -->
    <div id="new-chapter-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>新しい章を作成</h3>
                <button class="close-btn" onclick="closeNewChapterModal()">✕</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="chapter-title">章タイトル <span class="required">*</span></label>
                    <input type="text" id="chapter-title" placeholder="例: 第1章 始まりの街">
                </div>
                <div class="form-group">
                    <label for="chapter-summary">章の概要</label>
                    <textarea id="chapter-summary" rows="4" placeholder="この章で起こる出来事の概要..."></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="chapter-order">章番号</label>
                        <input type="number" id="chapter-order" min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label for="target-word-count">目標文字数</label>
                        <input type="number" id="target-word-count" min="100" value="3000">
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="primary-btn" onclick="saveNewChapter()">作成</button>
                <button class="secondary-btn" onclick="closeNewChapterModal()">キャンセル</button>
            </div>
        </div>
    </div>

    <script src="./js/mock-api.js"></script>
    <script src="./js/components/sidebar.js"></script>
    <script src="./js/project-selector.js"></script>
    <script src="./js/project-workspace.js"></script>
</body>
</html>