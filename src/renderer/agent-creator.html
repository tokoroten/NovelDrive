<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'">
    <title>エージェント作成 - NovelDrive</title>
    <link rel="stylesheet" href="./styles/common.css">
    <link rel="stylesheet" href="./styles/agent-creator.css">
</head>
<body>
    <div class="app-container">
        <!-- サイドバー -->
        <nav class="sidebar">
            <div class="app-title">
                <h1>NovelDrive</h1>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="./agent-meeting.html" data-page="agent-meeting">
                        <span class="icon">🤝</span>
                        <span>エージェント会議室</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./projects.html" data-page="projects">
                        <span class="icon">📁</span>
                        <span>プロジェクト</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./project-workspace.html" data-page="project-workspace">
                        <span class="icon">💼</span>
                        <span>ワークスペース</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./writing-editor.html" data-page="writing-editor">
                        <span class="icon">✍️</span>
                        <span>執筆エディタ</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./anything-box.html" data-page="anything-box">
                        <span class="icon">📥</span>
                        <span>なんでもボックス</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./serendipity.html" data-page="serendipity">
                        <span class="icon">✨</span>
                        <span>セレンディピティ</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./knowledge-graph.html" data-page="knowledge-graph">
                        <span class="icon">🕸️</span>
                        <span>ナレッジグラフ</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="./settings.html" data-page="settings">
                        <span class="icon">⚙️</span>
                        <span>設定</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- メインコンテンツ -->
        <main class="main-content">
            <header class="page-header">
                <div>
                    <h2>新しいエージェントを作成</h2>
                    <p class="page-description">小説創作を支援するAIエージェントをカスタマイズできます</p>
                </div>
                <button class="secondary-btn" onclick="window.location.href='./agent-meeting.html'">
                    <span class="icon">←</span>
                    会議室に戻る
                </button>
            </header>

            <!-- エージェント作成フォーム -->
            <div class="agent-creator-container">
                <form id="agent-creator-form">
                    <!-- 基本情報 -->
                    <section class="form-section">
                        <h3>基本情報</h3>
                        
                        <div class="form-group">
                            <label for="agent-name">エージェント名 <span class="required">*</span></label>
                            <input type="text" id="agent-name" required placeholder="例：歴史考証の専門家">
                            <small class="help-text">エージェントの名前を入力してください</small>
                        </div>

                        <div class="form-group">
                            <label for="agent-role">役割 <span class="required">*</span></label>
                            <select id="agent-role" required>
                                <option value="">役割を選択...</option>
                                <option value="writer">執筆者</option>
                                <option value="editor">編集者</option>
                                <option value="critic">批評家</option>
                                <option value="researcher">リサーチャー</option>
                                <option value="consultant">コンサルタント</option>
                                <option value="custom">カスタム</option>
                            </select>
                        </div>

                        <div class="form-group" id="custom-role-group" style="display: none;">
                            <label for="custom-role">カスタム役割名</label>
                            <input type="text" id="custom-role" placeholder="独自の役割名を入力">
                        </div>

                        <div class="form-group">
                            <label for="agent-avatar">アバター絵文字</label>
                            <div class="avatar-selector">
                                <input type="text" id="agent-avatar" value="🤖" maxlength="2" class="avatar-input">
                                <div class="avatar-presets">
                                    <button type="button" class="avatar-btn" data-avatar="👨‍💼">👨‍💼</button>
                                    <button type="button" class="avatar-btn" data-avatar="👩‍💼">👩‍💼</button>
                                    <button type="button" class="avatar-btn" data-avatar="🧙‍♂️">🧙‍♂️</button>
                                    <button type="button" class="avatar-btn" data-avatar="🧙‍♀️">🧙‍♀️</button>
                                    <button type="button" class="avatar-btn" data-avatar="👨‍🏫">👨‍🏫</button>
                                    <button type="button" class="avatar-btn" data-avatar="👩‍🏫">👩‍🏫</button>
                                    <button type="button" class="avatar-btn" data-avatar="🕵️">🕵️</button>
                                    <button type="button" class="avatar-btn" data-avatar="💡">💡</button>
                                    <button type="button" class="avatar-btn" data-avatar="📚">📚</button>
                                    <button type="button" class="avatar-btn" data-avatar="🎭">🎭</button>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- 性格設定 -->
                    <section class="form-section">
                        <h3>性格と特徴</h3>
                        
                        <div class="form-group">
                            <label for="personality-traits">性格特性</label>
                            <div class="trait-selector">
                                <label class="trait-option">
                                    <input type="checkbox" name="traits" value="analytical">
                                    <span>分析的</span>
                                </label>
                                <label class="trait-option">
                                    <input type="checkbox" name="traits" value="creative">
                                    <span>創造的</span>
                                </label>
                                <label class="trait-option">
                                    <input type="checkbox" name="traits" value="critical">
                                    <span>批判的</span>
                                </label>
                                <label class="trait-option">
                                    <input type="checkbox" name="traits" value="supportive">
                                    <span>協力的</span>
                                </label>
                                <label class="trait-option">
                                    <input type="checkbox" name="traits" value="detail-oriented">
                                    <span>詳細志向</span>
                                </label>
                                <label class="trait-option">
                                    <input type="checkbox" name="traits" value="big-picture">
                                    <span>全体志向</span>
                                </label>
                                <label class="trait-option">
                                    <input type="checkbox" name="traits" value="pragmatic">
                                    <span>実践的</span>
                                </label>
                                <label class="trait-option">
                                    <input type="checkbox" name="traits" value="theoretical">
                                    <span>理論的</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="communication-style">コミュニケーションスタイル</label>
                            <select id="communication-style">
                                <option value="formal">フォーマル（敬語）</option>
                                <option value="casual">カジュアル（タメ口）</option>
                                <option value="professional">プロフェッショナル</option>
                                <option value="friendly">フレンドリー</option>
                                <option value="mentor">メンター的</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="personality-description">詳細な性格設定</label>
                            <textarea id="personality-description" rows="4" 
                                placeholder="エージェントの性格、背景、特徴などを自由に記述してください。&#10;例：20年の執筆経験を持つベテラン編集者。厳しいが的確なアドバイスを提供する。"></textarea>
                        </div>
                    </section>

                    <!-- 専門分野 -->
                    <section class="form-section">
                        <h3>専門分野と知識</h3>
                        
                        <div class="form-group">
                            <label>ジャンル専門性</label>
                            <div class="genre-selector">
                                <label class="genre-option">
                                    <input type="checkbox" name="genres" value="fantasy">
                                    <span>ファンタジー</span>
                                </label>
                                <label class="genre-option">
                                    <input type="checkbox" name="genres" value="sf">
                                    <span>SF</span>
                                </label>
                                <label class="genre-option">
                                    <input type="checkbox" name="genres" value="mystery">
                                    <span>ミステリー</span>
                                </label>
                                <label class="genre-option">
                                    <input type="checkbox" name="genres" value="romance">
                                    <span>恋愛</span>
                                </label>
                                <label class="genre-option">
                                    <input type="checkbox" name="genres" value="horror">
                                    <span>ホラー</span>
                                </label>
                                <label class="genre-option">
                                    <input type="checkbox" name="genres" value="literary">
                                    <span>純文学</span>
                                </label>
                                <label class="genre-option">
                                    <input type="checkbox" name="genres" value="historical">
                                    <span>歴史</span>
                                </label>
                                <label class="genre-option">
                                    <input type="checkbox" name="genres" value="youth">
                                    <span>青春</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="expertise">専門知識・スキル</label>
                            <textarea id="expertise" rows="3" 
                                placeholder="エージェントが持つ専門知識やスキルを記述してください。&#10;例：中世ヨーロッパの歴史、日本の民俗学、心理学、など"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="writing-style">得意な文体・スタイル</label>
                            <input type="text" id="writing-style" 
                                placeholder="例：叙情的な描写、簡潔な文体、会話重視、など">
                        </div>
                    </section>

                    <!-- 行動パターン -->
                    <section class="form-section">
                        <h3>行動パターン設定</h3>
                        
                        <div class="form-group">
                            <label for="feedback-style">フィードバックスタイル</label>
                            <select id="feedback-style">
                                <option value="encouraging">励まし型（ポジティブ重視）</option>
                                <option value="balanced">バランス型（良い点と改善点）</option>
                                <option value="critical">批評型（改善点重視）</option>
                                <option value="coaching">コーチング型（質問で導く）</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="response-length">返答の長さ</label>
                            <select id="response-length">
                                <option value="concise">簡潔（要点のみ）</option>
                                <option value="moderate">標準（適度な詳細）</option>
                                <option value="detailed">詳細（徹底的な分析）</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="creativity-level">創造性レベル</label>
                            <input type="range" id="creativity-level" min="0" max="100" value="50">
                            <div class="range-labels">
                                <span>保守的</span>
                                <span id="creativity-value">50</span>
                                <span>革新的</span>
                            </div>
                        </div>
                    </section>

                    <!-- システムプロンプト -->
                    <section class="form-section">
                        <h3>高度な設定</h3>
                        
                        <div class="form-group">
                            <label for="system-prompt">システムプロンプト（上級者向け）</label>
                            <textarea id="system-prompt" rows="6" 
                                placeholder="AIに与える具体的な指示を記述できます。空欄の場合は他の設定から自動生成されます。"></textarea>
                            <small class="help-text">OpenAI APIに送信されるシステムプロンプトを直接編集できます</small>
                        </div>

                        <button type="button" id="generate-prompt" class="secondary-btn">
                            <span class="icon">🔮</span>
                            設定からプロンプトを生成
                        </button>
                    </section>

                    <!-- プレビュー -->
                    <section class="form-section preview-section">
                        <h3>プレビュー</h3>
                        <div id="agent-preview" class="agent-preview">
                            <div class="preview-card">
                                <div class="preview-avatar">🤖</div>
                                <div class="preview-info">
                                    <h4 class="preview-name">エージェント名</h4>
                                    <p class="preview-role">役割</p>
                                    <p class="preview-description">性格や特徴がここに表示されます</p>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- アクションボタン -->
                    <div class="form-actions">
                        <button type="button" class="secondary-btn" onclick="window.location.href='./agent-meeting.html'">
                            キャンセル
                        </button>
                        <button type="submit" class="primary-btn">
                            <span class="icon">✨</span>
                            エージェントを作成
                        </button>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <!-- 作成成功モーダル -->
    <div id="success-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>エージェントが作成されました！</h3>
            </div>
            <div class="modal-body">
                <p>新しいエージェントが正常に作成されました。</p>
                <p>エージェント会議室で使用できます。</p>
            </div>
            <div class="modal-actions">
                <button class="primary-btn" onclick="goToAgentMeeting()">
                    会議室で使用する
                </button>
                <button class="secondary-btn" onclick="createAnother()">
                    別のエージェントを作成
                </button>
            </div>
        </div>
    </div>

    <script src="./js/mock-api.js"></script>
    <script src="./js/project-selector.js"></script>
    <script src="./js/agent-creator.js"></script>
</body>
</html>