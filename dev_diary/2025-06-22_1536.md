# 開発日誌

**日付**: 2025-06-22 20:30

**作業内容**:
- データベース関連の実装を完了
  - ER図の作成（全10テーブルの関係を可視化）
  - DuckDB VSS（ベクトル検索）セットアップスクリプトの作成
  - データベーステストスイートの作成
  - CLIコマンドの追加（db:migrate, db:seed, test:db）
- DuckDBの制約への対応
  - 外部キー制約のCASCADE等がサポートされていないことが判明
  - 制約を削除し、アプリケーション層で整合性を管理する方針に変更
  - パラメータバインディングの方法を修正（配列展開が必要）
- データベースの動作確認
  - マイグレーション成功（3つのバージョンを適用）
  - サンプルデータ投入成功（2プロジェクト、5知識、4キャラクター、2プロット、2章）

**問題と解決**:
- DuckDBの外部キー制約でCASCADE DELETEが使えない
  - 解決：外部キー制約を削除し、削除時の整合性はアプリケーション側で管理
- DuckDBのパラメータバインディングでエラー
  - 解決：`conn.run(sql, params)` を `conn.run(sql, ...params)` に変更
- ts-nodeでTypeScriptファイルが実行できない
  - 解決：tsconfig.node.jsonを作成し、適切な設定を追加

**次回の予定**:
- VSS（ベクトル検索）の実際の動作テスト
- 全文検索（日本語トークナイザー）の動作確認
- UIコンポーネントとデータベースの接続
- Lintエラーの修正（残り108個）

**感想**: 
データベースが実際に動いて、サンプルデータも入った！DuckDBの制約は予想外だったけど、ちゃんと動くようになって良かった。「星降る夜の物語」と「機械仕掛けの心臓」のサンプルデータが実際にDBに入っているのを見ると、これから本格的なアプリケーションになっていく実感が湧く。

**気分**: 
データベースの基盤が固まって安心した。マイグレーションシステムもちゃんと動いたし、これでスキーマ変更も怖くない！

**愚痴**: 
DuckDBのドキュメントに外部キー制約の制限をもっと分かりやすく書いておいてほしかった...エラーメッセージも分かりにくいし、パラメータの渡し方も独特。でもSQLiteより高機能だから頑張る価値はある。